# Azoth TUI

The `azoth-tui` crate provides a terminal-based user interface for viewing and analyzing debug traces generated by the Azoth obfuscator. This interactive viewer enables developers to inspect the step-by-step transformations applied during bytecode obfuscation.

## Architecture

The TUI crate implements a reactive terminal interface built on ratatui and crossterm:

1. **Debug Output Loading** - Parses JSON trace files produced by the obfuscator
2. **Trace Grouping** - Organizes trace events by transform phase for hierarchical navigation
3. **Detail Caching** - Pre-computes formatted output for responsive scrolling
4. **Decompile Diff** - Lazily computes structural differences between original and obfuscated bytecode

## Key Components

### Application State (`app.rs`)

Manages the core TUI state including view mode, trace groups, expansion state, and scroll positions. Supports two view modes:

- **Trace View** - Hierarchical list of transform operations with expandable groups
- **Decompile Diff View** - Side-by-side comparison of decompiled bytecode

### Data Structures (`data.rs`)

Defines the debug output format and display structures:

- `DebugOutput` - Main structure loaded from obfuscator JSON output
- `DebugMetadata` - Transform metadata including applied passes and flags
- `ListEntry` - Display items including group headers, operations, and collapsible groups
- `TraceGroup` - Groups of trace events belonging to a transform phase

### Event Handling (`event.rs`)

Processes keyboard and mouse input with vim-style navigation:

- `j/k` or arrows - Navigate up/down
- `Enter/Space` - Expand/collapse groups
- `Tab` - Toggle between trace and diff views
- `d/u` or PageDown/PageUp - Scroll by page
- `q/Esc` - Quit

### Formatting (`format/`)

Pre-computes styled output for trace events:

- `cache.rs` - Builds detail cache for all entries
- `operation.rs` - Formats individual trace operations
- `bytecode.rs` - Formats bytecode snippets with syntax highlighting
- `diff.rs` - Formats decompile diff output

### UI Rendering (`ui/`)

Renders the terminal interface:

- `header.rs` - Status bar with filename and view mode
- `list.rs` - Scrollable trace event list with selection
- `detail.rs` - Detail panel showing selected item information
- `diff.rs` - Split-pane diff view

## Usage

The TUI is typically invoked through the CLI:

```bash
# View debug trace from obfuscation output
azoth debug trace.json
```

Programmatic usage:

```rust
use azoth_tui::{load_debug_file, run};
use std::path::Path;

let debug = load_debug_file(Path::new("trace.json"))?;
run(debug, Some("trace.json".to_string()))?;
```

## Dependencies

The crate uses:

- `ratatui` - Terminal UI framework
- `crossterm` - Cross-platform terminal handling
- `azoth-core` - Trace event definitions
- `azoth-analysis` - Decompile diff analysis
